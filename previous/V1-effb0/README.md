# 图像分类项目

## 项目概述
这是一个处理类别不平衡的图像分类项目，使用EfficientNet-B0模型对60×80像素的图像进行44类分类。项目特点是处理了严重的类别不平衡问题（最大类别12341样本，最小类别仅个位数）。

## 数据集特点
- 训练集：35,551张图片
- 测试集：8,889张图片
- 图片尺寸：60×80像素
- 类别数：44类
- 类别分布：
  - 平均样本数：807
  - 中位数：166
  - 标准差：2048
  - 最大类别样本数：12341
  - 最小类别样本数：个位数

## 技术方案

### 1. 模型选择
- 基础模型：EfficientNet-B0
- 预训练：使用ImageNet预训练权重
- 选择原因：
  - 轻量级但效果好
  - 适合小尺寸图片
  - 训练速度快
  - 参数量适中

### 2. 类别不平衡处理
- 实现方案：
  1. 类别权重采样
     - 使用WeightedRandomSampler
     - 权重计算：1/类别频率，并进行归一化
  2. 数据增强
     - 随机水平翻转
     - 随机旋转（±10度）
     - 亮度和对比度调整（±0.2）

### 3. 训练优化

#### 3.1 学习率策略
- 初始学习率：0.001
- 学习率调度：ReduceLROnPlateau
  - 监控指标：训练准确率
  - 调整系数：0.1
  - 耐心值：3轮
  - 模式：max（准确率提升）

#### 3.2 优化器设置
- 优化器：AdamW
- 权重衰减：1e-4
- 批次大小：64

#### 3.3 训练细节
- 训练轮数：30
- 保存策略：保存最佳准确率模型
- 数据加载：4个工作线程

### 4. 代码优化和鲁棒性

#### 4.1 数据验证
- CSV文件完整性检查
- 图片文件存在性验证
- 标签范围验证
- 类别分布统计

#### 4.2 错误处理
- 详细的异常捕获
- 分级日志记录
- 图片读取错误处理
- 数据转换异常处理

#### 4.3 性能优化
- 数据预加载
- 多线程数据加载
- 批处理训练
- GPU加速支持

## 项目结构
```
image_classification/
├── config.py          # 配置文件
├── dataset.py         # 数据集实现
├── train.py           # 训练和推理脚本
├── requirements.txt   # 项目依赖
└── README.md          # 项目文档
```

## 使用方法

### 1. 环境配置
```bash
pip install -r requirements.txt
```

### 2. 数据准备
- 将训练集图片放入训练目录
- 将测试集图片放入测试目录
- 准备训练集CSV文件（包含id和target列）
- 准备测试集CSV文件（包含id列）

### 3. 配置修改
修改`config.py`中的相关配置：
- 数据路径
- 训练参数
- 模型参数

### 4. 开始训练
```bash
python train.py
```

## 可能的改进方向

1. 模型改进：
   - 尝试其他EfficientNet变体
   - 使用模型集成
   - 添加注意力机制

2. 数据增强：
   - 添加更多数据增强方法
   - 使用自动增强策略
   - 实现混合数据增强

3. 训练策略：
   - 实现交叉验证
   - 使用循环学习率
   - 添加早停机制

4. 推理优化：
   - 实现TTA（测试时增强）
   - 添加模型量化
   - 实现批量推理

## 注意事项
1. 确保数据集格式正确
2. 监控训练日志中的类别分布信息
3. 根据GPU显存大小调整批次大小
4. 定期保存检查点避免训练中断
5. 注意测试集预测结果的格式
